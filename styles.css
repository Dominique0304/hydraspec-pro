:root {
    /* Dark Theme (Default) */
    --bg-app: #121212;
    --bg-panel: #1e1e1e;
    --text-main: #e0e0e0;
    --text-muted: #a0a0a0;
    --border-color: #333;
    --input-bg: #2c2c2c;
    --accent-blue: #2196F3;
    --accent-green: #4CAF50;
    --accent-red: #f44336;
    --accent-gold: #FFD700;
    --font-main: 'Segoe UI', Roboto, sans-serif;
    --shadow: 0 2px 5px rgba(0,0,0,0.2);
    --resizer-bg: #444;
      --transition-fast: 0.15s ease;
    --transition-medium: 0.3s ease;
    --transition-slow: 0.5s ease;
    --border-radius-sm: 4px;
    --border-radius-md: 6px;
    --border-radius-lg: 8px;
    --focus-ring: 2px solid var(--accent-blue);
    --focus-offset: 2px;
}

[data-theme="light"] {
    --bg-app: #f0f2f5;
    --bg-panel: #ffffff;
    --text-main: #333333;
    --text-muted: #666666;
    --border-color: #ddd;
    --input-bg: #f8f9fa;
    --shadow: 0 2px 5px rgba(0,0,0,0.1);
    --resizer-bg: #ccc;
}

/* STEAMPUNK THEME */
[data-theme="steampunk"] {
    --bg-app: #2b2b2b;
    --bg-panel: #3e2723; /* Dark Wood */
    --text-main: #d4af37; /* Brass */
    --text-muted: #b87333; /* Copper */
    --border-color: #8b4513; /* Leather */
    --input-bg: #1a1a1a;
    --accent-blue: #00bcd4; /* Steam Blue */
    --accent-green: #76ff03; /* Radium */
    --accent-red: #ff3d00; /* Furnace */
    --accent-gold: #ffd700;
    --font-main: 'Courier New', monospace; /* Typewriter */
    --shadow: 4px 4px 0px #1a1a1a;
    --resizer-bg: #8b4513;
}

body {
    font-family: var(--font-main);
    background-color: var(--bg-app);
    color: var(--text-main);
    margin: 0;
    padding: 0;
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    transition: all 0.3s;
}

/* Header */
header {
    background-color: var(--bg-panel);
    border-bottom: 1px solid var(--accent-blue);
    padding: 0 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 50px;
    flex-shrink: 0;
    box-shadow: var(--shadow);
    z-index: 100;
}

[data-theme="steampunk"] header {
    border-bottom: 2px solid #d4af37;
    background-image: repeating-linear-gradient(45deg, #3e2723 0, #3e2723 10px, #4e342e 10px, #4e342e 20px);
}

.brand {
    font-size: 1.2rem;
    font-weight: bold;
    color: var(--accent-blue);
    letter-spacing: 1px;
    display: flex;
    align-items: center;
    gap: 10px;
}
[data-theme="steampunk"] .brand { color: #d4af37; text-shadow: 1px 1px 0 #000; }

.status-bar { font-size: 0.8rem; color: var(--text-muted); margin-right: 10px; }

/* Layout */
.main-container {
    display: flex;
    flex: 1;
    overflow: hidden;
}

.sidebar {
    width: 320px;
    min-width: 320px;
    background: var(--bg-panel);
    border-right: 1px solid var(--border-color);
    padding: 10px 0;
    overflow-y: auto;
    overflow-x: hidden;
}
[data-theme="steampunk"] .sidebar { border-right: 2px solid #8b4513; }

.control-group h3 {
    margin: 0 0 12px 0;
    font-size: 0.9rem;
    color: var(--accent-blue);
    display: flex;
    align-items: center;
    gap: 8px;
}
[data-theme="steampunk"] .control-group { border-bottom: 1px dashed #8b4513; }

.control-group h3 {
    font-size: 0.85rem;
    text-transform: uppercase;
    color: var(--text-muted);
    margin: 0 0 0.5rem 0;
    display: flex;
    align-items: center;
    gap: 8px;
}

.control-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    min-width: 0;
}

label { font-size: 0.85rem; }
.control-row label {
    flex-shrink: 1;
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    margin-right: 8px;
    font-size: 0.85rem;
}
input, select, textarea {
    background-color: var(--input-bg);
    border: 1px solid var(--border-color);
    color: var(--text-main);
    padding: 5px 8px;
    border-radius: 4px;
    font-family: inherit;
}
[data-theme="steampunk"] input, [data-theme="steampunk"] select, [data-theme="steampunk"] textarea {
    border: 1px solid #b87333;
    background-color: #2b2b2b;
    color: #d4af37;
}

button {
    background-color: #333;
    color: white;
    border: 1px solid #555;
    padding: 8px 12px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-size: 0.9rem;
    font-family: inherit;
}

button:hover { filter: brightness(1.2); }
button.primary { background-color: var(--accent-blue); border-color: var(--accent-blue); }
button.success { background-color: var(--accent-green); border-color: var(--accent-green); }
button.icon-btn { padding: 4px 8px; font-size: 0.8rem; background: transparent; border: 1px solid var(--border-color); color: var(--text-muted); }


[data-theme="steampunk"] button {
    background-image: linear-gradient(to bottom, #5d4037, #3e2723);
    border: 2px solid #8b4513;
    color: #d4af37;
    box-shadow: inset 0 0 5px #000;
}
[data-theme="steampunk"] button.primary {
    background-image: linear-gradient(to bottom, #0277bd, #01579b);
    border-color: #0288d1;
    color: #fff;
}

/* Dropdown */
.dropdown { position: relative; display: inline-block; }
.dropdown-content {
    display: none;
    position: absolute;
    right: 0;
    background-color: var(--bg-panel);
    min-width: 200px;
    box-shadow: 0 8px 16px rgba(0,0,0,0.5);
    border: 1px solid var(--border-color);
    z-index: 1000;
    border-radius: 4px;
}
.dropdown-content button {
    width: 100%;
    justify-content: flex-start;
    background: none;
    border: none;
    color: var(--text-main);
    text-align: left;
    border-radius: 0;
}
.dropdown-content button:hover { background-color: rgba(255,255,255,0.1); }
.dropdown:hover .dropdown-content { display: block; }

/* Plots Area */
.plots-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 10px;
    gap: 0;
    background-color: var(--bg-app);
    overflow: hidden;
    position: relative;
}
[data-theme="steampunk"] .plots-area {
    background-image: radial-gradient(#3e2723 1px, transparent 1px);
    background-size: 20px 20px;
}

.plot-container {
    background-color: var(--bg-panel);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    min-height: 100px; 
    position: relative;
    padding: 30px 10px 10px 10px;
    display: flex;
    flex-direction: column;
    box-shadow: var(--shadow);
    overflow: hidden;
}
[data-theme="steampunk"] .plot-container {
    border: 2px solid #b87333;
    box-shadow: 5px 5px 10px rgba(0,0,0,0.5);
}

/* Resizer */
.gutter-v {
    height: 10px;
    cursor: ns-resize;
    background: transparent;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: background 0.2s;
}
.gutter-v::after {
    content: "";
    width: 30px;
    height: 4px;
    background-color: var(--resizer-bg);
    border-radius: 2px;
}
.gutter-v:hover::after { background-color: var(--accent-blue); }

.plot-toolbar {
    position: absolute;
    top: 5px;
    left: 5px;
    right: 5px;
    height: 25px;
    display: flex;
    align-items: center;
    gap: 10px;
    z-index: 10;
}

.toolbar-title { font-size: 0.8rem; font-weight: bold; color: var(--text-muted); margin-right: auto; background: transparent !important; }
.toolbar-title span { background: transparent !important; }
.toolbar-title i { background: transparent !important; }

.stats-box {
    background: var(--input-bg);
    padding: 8px;
    border-radius: 4px;
    font-size: 0.8rem;
    margin-top: 5px;
    border: 1px solid var(--border-color);
}
.stat-row { display: flex; justify-content: space-between; margin-bottom: 2px; }
.stat-val { font-weight: bold; color: var(--accent-blue); font-family: monospace; }
[data-theme="steampunk"] .stat-val { color: #76ff03; }

/* Spectrogram specific */
.spectrogram-controls {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-top: 5px;
}

.spectrogram-controls label {
    font-size: 0.75rem;
}

.spectrogram-controls input,
.spectrogram-controls select {
    font-size: 0.75rem;
    padding: 3px 6px;
}

/* Modals */
.modal {
    display: none;
    position: fixed;
    z-index: 2000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.7);
    overflow-y: auto;
}

.modal-content {
    background-color: var(--bg-panel);
    color: var(--text-main);
    margin: 5% auto;
    padding: 20px;
    border: 1px solid var(--border-color);
    width: 600px;
    max-width: 90%;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    position: relative;
}
[data-theme="steampunk"] .modal-content {
    border: 4px double #d4af37;
    background-color: #3e2723;
}

.btn-close { float: right; background: none; border: none; color: var(--text-muted); cursor: pointer; font-size:1.2rem; }

/* Utility */
.settings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
.btn-small { padding: 4px 8px; font-size: 0.8rem; }

/* Animation Globale */
@keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
.gear-icon { display: inline-block; animation: rotate 8s linear infinite; }
[data-theme="steampunk"] .gear-icon { color: #d4af37; animation-duration: 4s; }

.row-removable { display:flex; gap:5px; margin-bottom:5px; align-items:center; }
.row-removable input { width: 30%; }

/* Help Content Formatting */
.help-body h4 { color: var(--accent-blue); margin-bottom: 5px; border-bottom: 1px solid var(--border-color); display:inline-block; margin-top: 15px; }
.help-body p { margin-bottom: 10px; font-size: 0.9rem; }
.help-body ul { padding-left: 20px; font-size: 0.9rem; }
.help-body li { margin-bottom: 5px; }

.color-scale {
    height: 20px;
    background: linear-gradient(to right, blue, cyan, green, yellow, red);
    border: 1px solid var(--border-color);
    border-radius: 3px;
    margin-top: 5px;
}
/* === SOLUTION SIMPLE POUR BARRE DE SCROLL === */

.sidebar {
    width: 320px;
    overflow-x: hidden;
}

.control-group {
    padding: 10px 12px;
}

.control-row input,
.control-row select {
    width: 85px;
}

textarea {
    width: 94%;
}
/* CORRECTION FONT AWESOME OFFLINE */
@font-face {
  font-family: 'Font Awesome 6 Free';
  font-style: normal;
  font-weight: 900;
  font-display: block;
  src: url("./lib/webfonts/fa-solid-900.woff2") format("woff2");
}

@font-face {
  font-family: 'Font Awesome 6 Brands';
  font-style: normal;
  font-weight: 400;
  font-display: block;
  src: url("./lib/webfonts/fa-brands-400.woff2") format("woff2");
}

@font-face {
  font-family: 'Font Awesome 6 Free';
  font-style: normal;
  font-weight: 400;
  font-display: block;
  src: url("./lib/webfonts/fa-regular-400.woff2") format("woff2");
}

/* Remplacer les classes FA par défaut */
.fas, .fa-solid {
  font-family: 'Font Awesome 6 Free';
  font-weight: 900;
}

.fab, .fa-brands {
  font-family: 'Font Awesome 6 Brands';
  font-weight: 400;
}

.far, .fa-regular {
  font-family: 'Font Awesome 6 Free';
  font-weight: 400;
}

/* ============================================
   STEAMPUNK2 THEME - VERSION INDUSTRIELLE AVEC FOND ENGRENAGES
============================================ */

[data-theme="steampunk2"] {
    /* Palette de couleurs industrielle */
    --bg-app: #1a1108; /* Fond sombre chaud */
    --bg-panel: #2c2419; /* Bois foncé/panneau métallique */
    --text-main: #e6d5b8; /* Crème vintage */
    --text-muted: #b8a27a; /* Laiton vieilli */
    --border-color: #7d5d34; /* Laiton oxydé */
    --input-bg: #3a2e1f; /* Fond sombre texturé */
    --accent-blue: #4a90e2; /* Bleu acier */
    --accent-green: #8bc34a; /* Vert oxydé */
    --accent-red: #d84315; /* Rouge rouille */
    --accent-gold: #ffc107; /* Or industriel */
    --resizer-bg: #8b7355; /* Cuivre */

    
    /* Police de secours si police spécifique non disponible */
    --font-main: 'Courier New', 'Georgia', monospace, serif;
    --shadow: 4px 4px 8px rgba(0,0,0,0.5), inset 2px 2px 4px rgba(255,255,255,0.1);
}

/* Pattern d'engrenages en SVG (base64) pour le fond */
:root {
    --gear-pattern: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M50,10 C60,10 68,16 70,25 L85,20 L90,35 L75,40 C77,50 72,60 62,65 L67,80 L52,85 L47,70 C37,67 27,72 22,82 L7,77 L2,62 L17,57 C15,47 20,37 30,32 L25,17 L40,12 L45,27 C55,30 65,25 70,15 Z' fill='none' stroke='%237d5d34' stroke-width='0.5' opacity='0.15'/%3E%3Ccircle cx='50' cy='50' r='8' fill='none' stroke='%237d5d34' stroke-width='0.3' opacity='0.1'/%3E%3Ccircle cx='20' cy='20' r='6' fill='none' stroke='%237d5d34' stroke-width='0.4' opacity='0.1'/%3E%3Ccircle cx='80' cy='80' r='6' fill='none' stroke='%237d5d34' stroke-width='0.4' opacity='0.1'/%3E%3C/svg%3E");
    
    --industrial-bg: url("data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M20,20 L180,20 L180,40 L20,40 Z' fill='none' stroke='%235d4a36' stroke-width='1' opacity='0.08'/%3E%3Cpath d='M40,60 L160,60 L160,80 L40,80 Z' fill='none' stroke='%235d4a36' stroke-width='1' opacity='0.08'/%3E%3Ccircle cx='100' cy='100' r='30' fill='none' stroke='%237d5d34' stroke-width='0.8' opacity='0.05' stroke-dasharray='5,5'/%3E%3Cpath d='M30,150 L170,150' stroke='%235d4a36' stroke-width='1' opacity='0.06'/%3E%3C/svg%3E");
}

/* Fond principal avec pattern d'engrenages */
[data-theme="steampunk2"] .plots-area {
    background-color: var(--bg-app);
    background-image: 
        var(--gear-pattern),
        var(--industrial-bg),
        radial-gradient(circle at 20% 30%, rgba(168, 121, 59, 0.05) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(212, 165, 95, 0.03) 0%, transparent 50%);
    background-size: 
        100px 100px,
        200px 200px,
        cover,
        cover;
    background-position: 
        0 0,
        50% 50%,
        0 0,
        0 0;
    animation: gears-rotate 120s infinite linear;
}

/* Animation subtile des engrenages */
@keyframes gears-rotate {
    0% { background-position: 0 0, 50% 50%, 0 0, 0 0; }
    100% { background-position: 100px 100px, 50% 50%, 0 0, 0 0; }
}

/* Graphiques avec fond de tableau de bord industriel */
[data-theme="steampunk2"] .plot-container {
    background: 
        /* Fond métallique texturé */
        linear-gradient(145deg, rgba(44, 36, 25, 0.85), rgba(58, 46, 31, 0.85)),
        /* Pattern de rivets */
        radial-gradient(circle at 15px 15px, rgba(168, 121, 59, 0.1) 2px, transparent 3px),
        radial-gradient(circle at calc(100% - 15px) 15px, rgba(168, 121, 59, 0.1) 2px, transparent 3px),
        radial-gradient(circle at 15px calc(100% - 15px), rgba(168, 121, 59, 0.1) 2px, transparent 3px),
        radial-gradient(circle at calc(100% - 15px) calc(100% - 15px), rgba(168, 121, 59, 0.1) 2px, transparent 3px),
        /* Grille technique */
        linear-gradient(rgba(168, 121, 59, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(168, 121, 59, 0.03) 1px, transparent 1px);
    background-size: 
        auto,
        200px 200px,
        200px 200px,
        200px 200px,
        200px 200px,
        20px 20px,
        20px 20px;
    border: 10px solid transparent;
    border-image: linear-gradient(45deg, #a8793b, #d4a55f, #8b7355, #5d4a36) 1;
    border-radius: 12px;
    box-shadow: 
        0 0 20px rgba(0, 0, 0, 0.9),
        inset 0 0 15px rgba(255, 223, 186, 0.1),
        0 6px 25px rgba(168, 121, 59, 0.4),
        inset 0 0 60px rgba(44, 36, 25, 0.7);
}

/* Canvas des graphiques avec effet verre industriel */
[data-theme="steampunk2"] canvas {
    background-color: rgba(26, 17, 8, 0.6) !important;
    background-image: 
        /* Effet de luminosité radial */
        radial-gradient(circle at 50% 50%, rgba(212, 165, 95, 0.03) 0%, transparent 70%),
        /* Micro-texture */
        repeating-linear-gradient(
            45deg,
            transparent,
            transparent 2px,
            rgba(168, 121, 59, 0.02) 2px,
            rgba(168, 121, 59, 0.02) 4px
        );
    border: 2px solid rgba(168, 121, 59, 0.3);
    border-radius: 6px;
    box-shadow: 
        inset 0 0 30px rgba(0, 0, 0, 0.7),
        inset 0 0 10px rgba(212, 165, 95, 0.1),
        0 4px 15px rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(1px);
}

/* Effet de cadre métallique autour des canvas */
[data-theme="steampunk2"] canvas::before {
    content: '';
    position: absolute;
    top: -4px;
    left: -4px;
    right: -4px;
    bottom: -4px;
    border: 2px solid #5d4a36;
    border-radius: 10px;
    pointer-events: none;
    box-shadow: 
        inset 0 0 10px rgba(168, 121, 59, 0.2),
        0 0 20px rgba(0, 0, 0, 0.4);
    z-index: -1;
}

/* Bordures en laiton avec effet 3D - Panneaux industriels */
[data-theme="steampunk2"] .modal-content,
[data-theme="steampunk2"] .sidebar {
    border: 8px solid transparent;
    border-image: linear-gradient(45deg, #a8793b, #d4a55f, #8b7355, #5d4a36) 1;
    border-radius: 12px;
    box-shadow: 
        0 0 15px rgba(0, 0, 0, 0.8),
        inset 0 0 10px rgba(255, 223, 186, 0.2),
        0 4px 20px rgba(168, 121, 59, 0.3);
    background: 
        linear-gradient(145deg, rgba(44, 36, 25, 0.9), rgba(58, 46, 31, 0.9)),
        repeating-linear-gradient(
            45deg,
            transparent,
            transparent 10px,
            rgba(168, 121, 59, 0.1) 10px,
            rgba(168, 121, 59, 0.1) 20px
        ),
        /* Pattern industriel discret */
        linear-gradient(rgba(168, 121, 59, 0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(168, 121, 59, 0.02) 1px, transparent 1px);
    background-size: 
        auto,
        auto,
        50px 50px,
        50px 50px;
    position: relative;
    padding: 15px;
}

/* Effet rivets dans les coins */
[data-theme="steampunk2"] .plot-container::before,
[data-theme="steampunk2"] .modal-content::before,
[data-theme="steampunk2"] .sidebar::before {
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    background-image: 
        /* Rivets aux coins */
        radial-gradient(circle at 15px 15px, #d4a55f 4px, transparent 5px),
        radial-gradient(circle at calc(100% - 15px) 15px, #d4a55f 4px, transparent 5px),
        radial-gradient(circle at 15px calc(100% - 15px), #d4a55f 4px, transparent 5px),
        radial-gradient(circle at calc(100% - 15px) calc(100% - 15px), #d4a55f 4px, transparent 5px),
        /* Rivets intermédiaires */
        radial-gradient(circle at 50% 10px, #8b7355 3px, transparent 4px),
        radial-gradient(circle at 50% calc(100% - 10px), #8b7355 3px, transparent 4px),
        radial-gradient(circle at 10px 50%, #8b7355 3px, transparent 4px),
        radial-gradient(circle at calc(100% - 10px) 50%, #8b7355 3px, transparent 4px);
    pointer-events: none;
    z-index: 1;
}

/* Boutons avec effet levier/métal - Version améliorée */
[data-theme="steampunk2"] button {
    background: 
        linear-gradient(145deg, #d4a55f, #8b7355, #5d4a36),
        /* Texture métallique */
        repeating-linear-gradient(
            45deg,
            rgba(255,255,255,0.1) 0px,
            rgba(255,255,255,0.1) 1px,
            transparent 1px,
            transparent 5px
        );
    border: 3px solid #5d4a36;
    border-radius: 6px;
    color: #1a0f08;
    text-transform: uppercase;
    font-weight: bold;
    letter-spacing: 1px;
    box-shadow: 
        0 6px 0 #3a2e1f,
        0 8px 12px rgba(0,0,0,0.5),
        inset 0 1px 2px rgba(255,255,255,0.2);
    position: relative;
    overflow: hidden;
    transition: all 0.15s ease;
    padding: 12px 24px;
    font-family: 'Courier New', monospace;
    text-shadow: 1px 1px 1px rgba(255,255,255,0.3);
}

[data-theme="steampunk2"] button:hover {
    transform: translateY(2px);
    box-shadow: 
        0 4px 0 #3a2e1f,
        0 6px 10px rgba(0,0,0,0.4),
        inset 0 1px 2px rgba(255,255,255,0.3);
    background: linear-gradient(145deg, #e6b563, #9c8465, #6d5a46);
}

[data-theme="steampunk2"] button:active {
    transform: translateY(6px);
    box-shadow: 
        0 0 0 #3a2e1f,
        0 2px 6px rgba(0,0,0,0.3),
        inset 0 2px 4px rgba(0,0,0,0.3);
}

/* Inputs style cadran de contrôle */
[data-theme="steampunk2"] input,
[data-theme="steampunk2"] select,
[data-theme="steampunk2"] textarea {
    background: 
        linear-gradient(to bottom, #3a2e1f, #2c2419),
        /* Texture de métal usiné */
        repeating-linear-gradient(
            90deg,
            rgba(168, 121, 59, 0.05) 0px,
            rgba(168, 121, 59, 0.05) 1px,
            transparent 1px,
            transparent 4px
        );
    border: 2px solid #8b7355;
    border-radius: 6px;
    color: #e6d5b8;
    box-shadow: 
        inset 0 4px 8px rgba(0,0,0,0.6),
        0 2px 4px rgba(255,223,186,0.1),
        inset 0 0 20px rgba(0,0,0,0.3);
    font-family: 'Courier New', monospace;
    padding: 10px 14px;
    transition: all 0.3s ease;
}

/* Animation de vapeur industrielle */
[data-theme="steampunk2"]::after {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: 
        /* Particules de vapeur */
        radial-gradient(circle at 10% 20%, rgba(212, 165, 95, 0.03) 0%, transparent 50%),
        radial-gradient(circle at 90% 40%, rgba(212, 165, 95, 0.02) 0%, transparent 50%),
        radial-gradient(circle at 20% 80%, rgba(212, 165, 95, 0.02) 0%, transparent 50%),
        radial-gradient(circle at 80% 60%, rgba(212, 165, 95, 0.03) 0%, transparent 50%);
    pointer-events: none;
    z-index: 9999;
    animation: steam-drift 40s infinite linear;
    mix-blend-mode: overlay;
}

@keyframes steam-drift {
    0% { background-position: 0 0, 0 0, 0 0, 0 0; }
    25% { background-position: -50px -100px, 100px 50px, 50px 150px, -100px 100px; }
    50% { background-position: -100px -200px, 200px 100px, 100px 300px, -200px 200px; }
    75% { background-position: -150px -300px, 300px 150px, 150px 450px, -300px 300px; }
    100% { background-position: -200px -400px, 400px 200px, 200px 600px, -400px 400px; }
}

/* Titres avec effet de plaque signalétique */
[data-theme="steampunk2"] .toolbar-title,
[data-theme="steampunk2"] .control-group h3 {
    background: linear-gradient(to right, rgba(90, 70, 40, 0.3), rgba(60, 50, 30, 0.3));
    padding: 8px 16px;
    border: 2px solid #8b7355;
    border-radius: 4px;
    color: #ffc107;
    text-shadow: 
        0 0 8px rgba(255, 193, 7, 0.8),
        2px 2px 2px rgba(0, 0, 0, 0.5);
    box-shadow: 
        inset 0 0 10px rgba(212, 165, 95, 0.2),
        0 4px 6px rgba(0,0,0,0.4);
    position: relative;
    margin-bottom: 15px;
}

[data-theme="steampunk2"] .control-group h3::before {
    content: '⚙';
    margin-right: 10px;
    animation: rotation 4s infinite linear;
    display: inline-block;
}

/* Stats boxes style tableau de bord */
[data-theme="steampunk2"] .stats-box {
    background: 
        radial-gradient(ellipse at center, rgba(58, 46, 31, 0.8), rgba(44, 36, 25, 0.9)),
        /* Quadrillage technique */
        linear-gradient(rgba(212, 165, 95, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(212, 165, 95, 0.1) 1px, transparent 1px);
    background-size: 
        auto,
        20px 20px,
        20px 20px;
    border: 3px double #8b7355;
    border-radius: 8px;
    box-shadow: 
        inset 0 0 30px rgba(0,0,0,0.7),
        0 6px 15px rgba(0,0,0,0.4),
        inset 0 0 0 1px rgba(212, 165, 95, 0.1);
    padding: 15px;
}

/* Animation d'engrenage principale */
@keyframes rotation {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* Scrollbar style industriel */
[data-theme="steampunk2"] ::-webkit-scrollbar {
    width: 12px;
    background: #2c2419;
    border: 1px solid #5d4a36;
}

[data-theme="steampunk2"] ::-webkit-scrollbar-thumb {
    background: linear-gradient(to bottom, #d4a55f, #8b7355);
    border: 2px solid #3a2e1f;
    border-radius: 6px;
    box-shadow: inset 0 0 4px rgba(0,0,0,0.5);
}

[data-theme="steampunk2"] ::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(to bottom, #e6b563, #9c8465);
}


.toggle-btn.active {
    background-color: var(--accent-blue);
    border-color: var(--accent-blue);
    color: white;
}

.toggle-btn:not(.active) {
    background-color: #555;
    border-color: #777;
    color: #aaa;
    opacity: 0.7;
}

.toggle-btn:not(.active):hover {
    opacity: 1;
    filter: brightness(1.2);
}

/* Style pour l'icône d'état */
.toggle-btn::after {
    content: "✓";
    position: absolute;
    top: -5px;
    right: -5px;
    background: var(--accent-green);
    color: white;
    font-size: 0.6rem;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s;
}

.toggle-btn.active::after {
    opacity: 1;
}

/* Ajout pour les thèmes */
[data-theme="light"] .toggle-btn:not(.active) {
    background-color: #e0e0e0;
    border-color: #ccc;
    color: #666;
}

[data-theme="steampunk"] .toggle-btn.active {
    background-image: linear-gradient(to bottom, #0277bd, #01579b);
    border-color: #0288d1;
    color: #fff;
}

[data-theme="steampunk2"] .toggle-btn.active {
    background: linear-gradient(145deg, #d4a55f, #8b7355, #5d4a36);
    border: 2px solid #5d4a36;
    color: #1a0f08;
    box-shadow: 0 4px 0 #3a2e1f;
}

/* Masquage des conteneurs de graphiques */
.plot-container.hidden {
    display: none !important;
}

/* Masquage des panneaux de contrôle */
.control-group.hidden {
    display: none !important;
}

/* Ajustement pour les resizers quand un graphique est masqué */
.gutter-v.hidden {
    display: none !important;
}

/* Styles focus pour accessibilité */
button:focus,
input:focus,
select:focus,
textarea:focus {
    outline: var(--focus-ring);
    outline-offset: var(--focus-offset);
}

/* Masquer visuellement mais accessible aux lecteurs d'écran */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}
/* Harmonisation des boutons d'en-tête */
.header-btn {
    background-color: var(--bg-panel);
    border: 1px solid var(--border-color);
    color: var(--text-main);
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    font-size: 0.85rem;
    font-family: inherit;
    height: 32px;
}

.header-btn:hover {
    background-color: var(--input-bg);
    border-color: var(--accent-blue);
}

/* Spécifique pour les boutons toggle */
.toggle-btn {
    background-color: var(--bg-panel);
    border: 1px solid var(--border-color);
    color: var(--text-main);
}



.toggle-btn:not(.active) {
    opacity: 0.7;
}

.toggle-btn:not(.active):hover {
    opacity: 1;
    background-color: var(--input-bg);
}

/* Ajustement pour le dropdown "Outils" */
.dropdown > .header-btn {
    padding: 6px 12px;
}

/* Ajustements pour les thèmes spéciaux */
[data-theme="steampunk"] .header-btn {
    background-image: linear-gradient(to bottom, #5d4037, #3e2723);
    border: 2px solid #8b4513;
    color: #d4af37;
    box-shadow: inset 0 0 5px #000;
}

[data-theme="steampunk"] .toggle-btn.active {
    background-image: linear-gradient(to bottom, #0277bd, #01579b);
    border-color: #0288d1;
    color: white;
    box-shadow: 0 0 10px rgba(2, 119, 189, 0.5);
}

[data-theme="steampunk2"] .header-btn {
    background: linear-gradient(145deg, #d4a55f, #8b7355, #5d4a36);
    border: 2px solid #5d4a36;
    color: #1a0f08;
    font-weight: bold;
    text-shadow: 1px 1px 1px rgba(255,255,255,0.3);
}

[data-theme="steampunk2"] .toggle-btn.active {
    background: linear-gradient(145deg, #0277bd, #01579b);
    border-color: #0288d1;
    color: white;
    text-shadow: none;
}
@keyframes pulse {
    0% { opacity: 0.5; }
    50% { opacity: 1; }
    100% { opacity: 0.5; }
}




[data-theme="steampunk2"] .status-bar {
    color: #d4a55f !important;
    background: rgba(44, 36, 25, 0.5) !important;
    border-left: 2px solid #8b7355 !important;
    text-shadow: 0 0 5px rgba(212, 165, 95, 0.3);
}

/* Toolbar améliorée pour alignement horizontal */
.plot-toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: absolute;
    top: 5px;
    left: 5px;
    right: 5px;
    height: 25px;
    z-index: 10;
}

.toolbar-controls {
    display: flex;
    gap: 8px;
    align-items: center;
}

.toolbar-title {
    font-size: 0.8rem;
    font-weight: bold;
    color: var(--text-muted);
    margin-right: auto;
    background: transparent !important;
    display: flex;
    align-items: center;
    gap: 5px;
}

.toolbar-title span {
    background: transparent !important;
}

.toolbar-title i {
    background: transparent !important;
}

/* Ajouter focus styles pour accessibilité */
button:focus, input:focus, select:focus {
    outline: 2px solid var(--accent-blue);
    outline-offset: 2px;
}

/* Améliorer le contraste pour le thème steampunk2 */
[data-theme="steampunk2"] .text-muted {
    color: #e6d5b8 !important;
    opacity: 0.2;
}

[data-theme="steampunk2"] select {
    background-color: #2c2419 !important;
    background-image: none !important;
    color: #e6d5b8 !important;
    border: 2px solid #8b7355 !important;
}



/* Halo de souris - Style */
#mouse-halo {
    position: fixed;

    border: 2px solid var(--accent-blue);
    border-radius: 50%;
    pointer-events: none;
    z-index: 9999;
    opacity: 0;
    transition: all 0.2s ease-out;
    transform: translate(-50%, -50%);
    box-shadow: 0 0 15px currentColor, inset 0 0 10px currentColor;
    mix-blend-mode: screen;
    will-change: transform;
}

#mouse-halo.visible {
    opacity: 0.7;
}

/* Taille réduite pour le mode "petit" */
#mouse-halo.small {
    width: 50px;
    height: 50px;
    border-width: 1.5px;
}

#mouse-halo.very-small {
    width: 30px;
    height: 30px;
    border-width: 1px;
    opacity: 0.9;
}

/* Couleurs selon les états */
#mouse-halo.shift-mode {
    border-color: var(--accent-green);
    box-shadow: 0 0 10px var(--accent-green), inset 0 0 5px var(--accent-green);
    color: var(--accent-green);
}

#mouse-halo.ctrl-mode {
    border-color: var(--accent-gold);
    box-shadow: 0 0 10px var(--accent-gold), inset 0 0 5px var(--accent-gold);
    color: var(--accent-gold);
}

#mouse-halo.clicking {
    border-color: var(--accent-red);
    box-shadow: 0 0 20px var(--accent-red), inset 0 0 10px var(--accent-red);
    color: var(--accent-red);
}

#mouse-halo.near-cursor {
    border-color: #FF9800; /* Orange pour indiquer la proximité */
    box-shadow: 0 0 10px #FF9800, inset 0 0 5px #FF9800;
    color: #FF9800;
}

/* Point central */
#mouse-halo::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 4px;
    height: 4px;
    background-color: currentColor;
    border-radius: 50%;
    transform: translate(-50%, -50%);
    opacity: 0.8;
}

/* Animation de pulsation pour la zone magnétique */
@keyframes magnetic-pulse {
    0% { box-shadow: 0 0 5px currentColor, inset 0 0 5px currentColor; }
    50% { box-shadow: 0 0 15px currentColor, inset 0 0 10px currentColor; }
    100% { box-shadow: 0 0 5px currentColor, inset 0 0 5px currentColor; }
}

#mouse-halo.near-cursor {
    animation: magnetic-pulse 1s infinite;
}

/* Adaptation pour les thèmes */
[data-theme="steampunk"] #mouse-halo {
    border-style: dashed;
}

[data-theme="steampunk"] #mouse-halo.shift-mode {
    border-color: #76ff03; /* Vert radium steampunk */
}

[data-theme="steampunk"] #mouse-halo.ctrl-mode {
    border-color: #ffd700; /* Or steampunk */
}

[data-theme="steampunk2"] #mouse-halo {
    border-style: solid;
    box-shadow: 0 0 20px currentColor, inset 0 0 15px currentColor;
}

[data-theme="steampunk2"] #mouse-halo.shift-mode {
    border-color: #8bc34a; /* Vert oxydé steampunk2 */
}

[data-theme="steampunk2"] #mouse-halo.ctrl-mode {
    border-color: #ffc107; /* Or industriel steampunk2 */
}

/* Supprimer les anciennes animations si présentes */
#mouse-halo {
    animation: none !important;
}

/* ============================================
   ANNOTATIONS SYSTEM - Notes flottantes
   ============================================ */

/* Conteneur principal */
#annotations-container {
    pointer-events: none;
    z-index: 500;
}

/* Marqueurs sur la courbe */
.annotation-marker {
    position: absolute;
    border-radius: 50%;
    border: 2px solid white;
    box-shadow: 0 0 5px rgba(0,0,0,0.5);
    cursor: pointer;
    transition: all 0.2s ease;
    z-index: 550;
}

.annotation-marker:hover {
    transform: scale(1.3) !important;
    box-shadow: 0 0 10px currentColor;
}

/* Notes flottantes */
.annotation-note {
    position: absolute;
    background: linear-gradient(to bottom, rgba(255,255,255,0.95), rgba(240,240,240,0.95));
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.15);
    padding: 10px;
    cursor: move;
    opacity: 0.9;
    z-index: 600;
    font-family: var(--font-main);
    color: #333;
    overflow: hidden;
    transition: all 0.3s ease;
    backdrop-filter: blur(2px);
    min-width: 180px;
    max-width: 300px;
}

.annotation-note:hover {
    box-shadow: 0 6px 20px rgba(0,0,0,0.2);
    opacity: 1;
}

.annotation-note.dragging {
    opacity: 0.7;
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
}

.annotation-note.resizing {
    opacity: 0.8;
    border: 2px dashed var(--border-color);
}

/* En-tête de note */
.note-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    padding-bottom: 5px;
    border-bottom: 1px solid rgba(0,0,0,0.1);
}

.note-header .note-icon {
    font-size: 1.2em;
    margin-right: 5px;
}

.note-header .note-title {
    font-weight: bold;
    font-size: 0.9em;
    flex-grow: 1;
}

.note-actions {
    display: flex;
    gap: 5px;
}

.note-btn {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 0.9em;
    padding: 2px 5px;
    border-radius: 3px;
    transition: background-color 0.2s;
}

.note-btn:hover {
    background-color: rgba(0,0,0,0.1);
}

/* Contenu de la note */
.note-content {
    font-size: 0.85em;
    line-height: 1.4;
    max-height: 150px;
    overflow-y: auto;
    word-wrap: break-word;
}

.note-content:empty::before {
    content: "Cliquez pour éditer";
    color: #999;
    font-style: italic;
}

/* Pied de note */
.note-footer {
    margin-top: 8px;
    font-size: 0.7em;
    color: #666;
    text-align: right;
    border-top: 1px solid rgba(0,0,0,0.05);
    padding-top: 5px;
}

/* Panneau d'annotations dans la sidebar */
#annotations-panel {
    border-top: 2px solid var(--accent-blue);
}

.annotation-filters {
    margin: 10px 0;
    padding: 10px;
    background: var(--input-bg);
    border-radius: 4px;
    border: 1px solid var(--border-color);
}

.annotation-filters label {
    display: block;
    margin-bottom: 5px;
    font-size: 0.85em;
    cursor: pointer;
}

.annotation-filters input[type="checkbox"] {
    margin-right: 6px;
    cursor: pointer;
}

/* Liste des annotations */
.annotations-list {
    max-height: 250px;
    overflow-y: auto;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    background: var(--input-bg);
    padding: 5px;
}

.annotations-list.empty {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 60px;
    color: var(--text-muted);
    font-style: italic;
}

.annotations-list-item {
    padding: 8px;
    margin: 4px 0;
    background: var(--bg-panel);
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.8em;
    border-left: 4px solid;
    transition: all 0.2s;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.annotations-list-item:hover {
    background: var(--accent-blue);
    color: white;
    transform: translateX(2px);
}

.annotations-list-item.selected {
    background: var(--accent-blue);
    color: white;
    font-weight: bold;
}

.annotations-list-item .item-time {
    font-family: monospace;
    font-size: 0.9em;
    color: inherit;
    opacity: 0.8;
}

.annotations-list-item .item-text {
    flex-grow: 1;
    margin: 0 8px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Modal d'édition */
.annotation-modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--bg-panel);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 20px;
    z-index: 10000;
    min-width: 350px;
    max-width: 500px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.4);
    animation: modal-appear 0.3s ease-out;
}

@keyframes modal-appear {
    from {
        opacity: 0;
        transform: translate(-50%, -60%);
    }
    to {
        opacity: 1;
        transform: translate(-50%, -50%);
    }
}

.annotation-modal h3 {
    margin-top: 0;
    margin-bottom: 15px;
    color: var(--accent-blue);
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 8px;
}

.annotation-modal label {
    display: block;
    margin: 10px 0 5px 0;
    font-size: 0.9em;
    font-weight: bold;
    color: var(--text-muted);
}

.annotation-modal textarea {
    width: 100%;
    min-height: 100px;
    margin: 5px 0 15px 0;
    font-family: inherit;
    resize: vertical;
}

/* Sélecteur de catégorie */
.category-selector {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
    margin: 10px 0;
}

.category-option {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px;
    border: 2px solid transparent;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
    background: var(--input-bg);
}

.category-option:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.category-option.selected {
    border-color: var(--accent-blue);
    background: rgba(33, 150, 243, 0.1);
}

.category-option .cat-icon {
    font-size: 1.5em;
    margin-bottom: 5px;
}

.category-option .cat-name {
    font-size: 0.8em;
    text-align: center;
}

/* Picker de couleurs */
.color-picker {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin: 15px 0;
    padding: 10px;
    background: var(--input-bg);
    border-radius: 6px;
}

.color-option {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid transparent;
    transition: all 0.2s;
}

.color-option:hover {
    transform: scale(1.1);
}

.color-option.selected {
    border-color: white;
    box-shadow: 0 0 0 2px var(--accent-blue);
    transform: scale(1.15);
}

/* Boutons du modal */
.modal-buttons {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 20px;
    padding-top: 15px;
    border-top: 1px solid var(--border-color);
}

/* État du système */
#toggle-annotations.active,
#annotation-edit-mode.active {
    background-color: var(--accent-blue) !important;
    border-color: var(--accent-blue) !important;
    color: white !important;
}

#toggle-annotations.active i,
#annotation-edit-mode.active i {
    animation: pulse 2s infinite;
}

/* Adaptations pour les thèmes */
[data-theme="light"] .annotation-note {
    background: linear-gradient(to bottom, rgba(255,255,255,0.98), rgba(250,250,250,0.95));
    border: 1px solid #ddd;
}

[data-theme="steampunk"] .annotation-note {
    background: linear-gradient(to bottom, rgba(62, 39, 35, 0.95), rgba(78, 52, 46, 0.9));
    color: #d4af37;
    border: 2px solid #8b4513;
}

[data-theme="steampunk2"] .annotation-note {
    background: linear-gradient(145deg, rgba(44, 36, 25, 0.9), rgba(58, 46, 31, 0.85));
    color: #e6d5b8;
    border: 2px solid #8b7355;
    box-shadow: 0 6px 20px rgba(0,0,0,0.5);
}

[data-theme="steampunk"] .annotations-list-item:hover,
[data-theme="steampunk2"] .annotations-list-item:hover {
    background: linear-gradient(to right, #a8793b, #8b7355);
}

/* Responsive */
@media (max-width: 768px) {
    .annotation-note {
        min-width: 150px;
        max-width: 250px;
        font-size: 0.9em;
    }
    
    .category-selector {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .annotation-modal {
        min-width: 280px;
        max-width: 90vw;
    }
}

/* Scrollbar pour la liste des annotations */
.annotations-list::-webkit-scrollbar {
    width: 6px;
}

.annotations-list::-webkit-scrollbar-track {
    background: var(--input-bg);
    border-radius: 3px;
}

.annotations-list::-webkit-scrollbar-thumb {
    background: var(--accent-blue);
    border-radius: 3px;
}

.annotations-list::-webkit-scrollbar-thumb:hover {
    background: var(--accent-green);
}

/* Animation pour nouveaux marqueurs */
@keyframes marker-appear {
    0% {
        transform: scale(0);
        opacity: 0;
    }
    70% {
        transform: scale(1.2);
        opacity: 1;
    }
    100% {
        transform: scale(1);
    }
}

.annotation-marker.new {
    animation: marker-appear 0.4s ease-out;
}

/* Animation pour nouvelles notes */
@keyframes note-appear {
    0% {
        transform: scale(0.8) translateY(20px);
        opacity: 0;
    }
    100% {
        transform: scale(1) translateY(0);
        opacity: 0.9;
    }
}

.annotation-note.new {
    animation: note-appear 0.3s ease-out;
}